# 新規クライアント向け Firebaseプロジェクト作成手順

このドキュメントは、AIリノベーション・シミュレーターを新しいクライアント向けにデプロイするために必要な、Firebaseプロジェクトの作成と設定情報取得の手順を説明します。

## 目的

クライアントごとに独立したFirebaseプロジェクトを作成することで、以下のメリットがあります。

- **データの分離:** 各クライアントの顧客データや商品データベースが完全に分離され、安全性が向上します。
- **独立したURL:** クライアントごとに独自のURL（例: `client-a-project.web.app`）が提供されます。
- **リソースの分離:** 各クライアントの利用状況が他のクライアントに影響を与えません。

## 手順

### ステップ1: Firebaseプロジェクトの新規作成

1.  **Firebaseコンソールにアクセス**
    [Firebaseコンソール](https://console.firebase.google.com/) を開き、Googleアカウントでログインします。

2.  **プロジェクトを追加**
    プロジェクト一覧ページで「**+ プロジェクトを追加**」をクリックします。

3.  **プロジェクト名の入力**
    プロジェクト名を入力します。後で管理しやすいように、命名規則を決めておくと便利です。
    **推奨:** `[アプリ名]-[クライアント名]` （例: `airenovation-client-a`）

4.  **Google アナリティクスの設定**
    このプロジェクトでGoogle アナリティクスを有効にするか尋ねられます。特に必要がなければ、「**このプロジェクトで Google アナリティクスを有効にする**」のチェックを外して進めるのが簡単です。

5.  **プロジェクトの作成**
    「**プロジェクトを作成**」ボタンをクリックします。作成が完了するまで数分待ちます。

### ステップ2: Firestoreデータベースの有効化

各クライアントの商品データベースなどを保存するために、Firestoreを有効化します。

1.  作成したプロジェクトのダッシュボードで、左側メニューから **ビルド** > **Firestore Database** を選択します。
2.  「**データベースの作成**」ボタンをクリックします。
3.  **本番環境モードで開始** を選択して「次へ」をクリックします。
4.  **Cloud Firestore のロケーション** を選択します。日本のクライアントであれば `asia-northeast1 (Tokyo)` が推奨されます。
5.  「**有効にする**」をクリックします。

### ステップ3: Cloud Storageの有効化

アプリケーションで画像などのファイルを保存するために、Cloud Storageを有効化します。

1.  作成したプロジェクトのダッシュボードで、左側メニューから **ビルド** > **Storage** を選択します。
2.  「**始める**」ボタンをクリックします。
3.  セキュリティルールについて尋ねられますが、デフォルトのルール（テストモード）で進めても構いません。後で必要に応じて変更できます。
4.  Cloud Storage のロケーションを選択し、「**完了**」をクリックします。

### ステップ4: Firebase Hostingの有効化

アプリケーションをデプロイするために、Hostingサービスを有効化します。

1.  左側メニューから **ビルド** > **Hosting** を選択します。
2.  「**始める**」ボタンをクリックします。
3.  画面にCLI（コマンド）のインストール手順などが表示されますが、デプロイはGitHub Actionsで行うため、これらはすべて無視して「**次へ**」「**次へ**」「**コンソールに進む**」とクリックしてウィザードを完了させてください。

### ステップ5: Webアプリを登録し、`FIREBASE_CONFIG` を取得

デプロイするWebアプリケーションをプロジェクトに登録し、接続設定情報を取得します。これはGitHubのSecret `FIREBASE_CONFIG_[CLIENT_NAME]` の値になります。

1.  プロジェクトダッシュボードの左上にある**歯車アイコン（⚙️）** > **プロジェクトを設定** をクリックします。
2.  **全般** タブの下部にある「マイアプリ」セクションまでスクロールします。
3.  **ウェブアイコン `</>`** をクリックして、新しいウェブアプリを登録します。
4.  **アプリのニックネーム** を入力します（例: `WebApp`）。
5.  **重要:** 「**このアプリの Firebase Hosting も設定します**」というチェックボックスが表示された場合は、**チェックを入れずに**「**アプリを登録**」をクリックしてください。（Hostingの設定はデプロイ時に自動で行われます）
6.  次の「Firebase SDK を追加」のステップで、`firebaseConfig` というオブジェクトが表示されます。
    ```javascript
    const firebaseConfig = {
      apiKey: "AIza...",
      authDomain: "...",
      projectId: "...",
      storageBucket: "...",
      messagingSenderId: "...",
      appId: "..."
    };
    ```
7.  この **`{ ... }` の中身（波括弧自体も含む）をすべてコピー**してください。これが **`FIREBASE_CONFIG_[CLIENT_NAME]`** の値になります。

### ステップ6: サービスアカウントの秘密鍵 (`FIREBASE_SERVICE_ACCOUNT`) を取得

GitHub ActionsがFirebaseにデプロイするための認証キーを取得します。これはGitHubのSecret `FIREBASE_SERVICE_ACCOUNT_[CLIENT_NAME]` の値になります。

1.  **プロジェクトを設定** > **サービスアカウント** タブに移動します。
2.  「**新しい秘密鍵の生成**」という青いボタンをクリックします。
3.  確認画面が表示されたら、「**キーを生成**」ボタンをクリックします。
4.  `[プロジェクト名]-firebase-adminsdk-....json` という名前のJSONファイルが自動的にダウンロードされます。
5.  この**ダウンロードされたファイルの中身をすべて**コピーしてください。これが **`FIREBASE_SERVICE_ACCOUNT_[CLIENT_NAME]`** の値になります。

### ステップ7: PINコードの設定

アプリケーションの認証に使用するPINコードをFirestoreに設定します。各クライアントごとに異なるPINコードを設定できます。

1.  作成したプロジェクトのダッシュボードで、左側メニューから **ビルド** > **Firestore Database** を選択します。
2.  「**データ**」タブに移動します。
3.  新しいコレクション「`config`」を作成します。
4.  `config`コレクション内に新しいドキュメント「`auth`」を作成します。
5.  `auth`ドキュメント内にフィールド「`pin`」（型: `string`）を追加し、希望する6桁のPINコード（例: `"123456"`）を設定します。

---

## 次のステップ

以上で、新しいクライアント用のFirebaseプロジェクトの準備は完了です。

この後、今回取得した以下の2つの情報と、クライアント用の**Gemini APIキー**を使って、GitHubリポジトリの **Settings > Secrets and variables > Actions** に、対応する名前で3つのSecretを登録してください。

1.  **`FIREBASE_CONFIG_[CLIENT_NAME]`** (ステップ5で取得)
2.  **`FIREBASE_SERVICE_ACCOUNT_[CLIENT_NAME]`** (ステップ6で取得)
3.  **`GEMINI_API_KEY_[CLIENT_NAME]`** (クライアント用に用意したGemini APIキー)

